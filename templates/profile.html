{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>{{ profile_user.username }}'s Profile</h2>
  {% if profile_user != user %}
    {% if friendship %}
      {% if friendship.status == 'accepted' %}
        <span class="badge bg-success">Friends</span>
      {% elif friendship.status == 'pending' %}
        <span class="badge bg-warning text-dark">Request pending</span>
        {% if user.id == friendship.user1_id or user.id == friendship.user2_id %}
          <a href="{% url 'friend_accept' friendship.id %}" class="btn btn-sm btn-outline-primary ms-2">Accept</a>
        {% endif %}
      {% else %}
        <span class="badge bg-secondary">{{ friendship.status }}</span>
      {% endif %}
    {% else %}
      <a href="{% url 'friend_request' profile_user.username %}" class="btn btn-sm btn-outline-primary">Add Friend</a>
    {% endif %}
  {% endif %}
</div>

<div class="row g-3">
  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">About</h5>
        <p class="mb-1"><b>Bio:</b> {{ profile_user.profile.bio|default:'â€”' }}</p>
        <p class="mb-1"><b>Joined:</b> {{ profile_user.date_joined }}</p>
        <hr/>
        <p class="mb-1"><b>Friends:</b> {{ friends|length }}</p>
        <p class="mb-1"><b>Posts:</b> {{ posts|length }}</p>
        <p class="mb-1"><b>Likes given:</b> {{ likes_given }}</p>
        <p class="mb-0"><b>Comments made:</b> {{ comments_made }}</p>
        {% if friends %}
        <hr/>
        <div>
          <b>Friends list:</b>
          <ul class="mt-2">
            {% for f in friends %}
              <li><a href="{% url 'profile' f.username %}">{{ f.username }}</a></li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-md-8">
    <h4 class="mb-3">Posts</h4>
    {% for post in posts %}
      <div class="card mb-3">
        <div class="card-body">
          <p class="card-text">{{ post.content|linebreaks }}</p>
          <div class="text-muted small">{{ post.created_at }}</div>
          <div class="mt-2">
            <span class="badge bg-light text-dark">Likes: {{ post.likes.count }}</span>
          </div>
          <div class="mt-2">
            <strong>Comments:</strong>
            {% for c in post.comments.all %}
              <div class="border rounded p-2 my-1">
                <b>{{ c.user.username }}</b>: {{ c.content }}
              </div>
            {% empty %}
              <div class="text-muted">No comments yet.</div>
            {% endfor %}
          </div>
        </div>
      </div>
    {% empty %}
      <div class="text-muted">No posts yet.</div>
    {% endfor %}
  </div>
</div>
{% endblock %}
